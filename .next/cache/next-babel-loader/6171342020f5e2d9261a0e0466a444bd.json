{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport App from 'next/app';\nimport Parse from 'parse';\nimport { Provider } from 'react-redux';\nimport nextCookie from 'next-cookies';\nimport cookie from 'js-cookie';\nimport Router from 'next/router';\nimport * as qs from 'qs';\nimport { appWithTranslation, i18n } from '../i18n';\nimport withReduxStore from '../lib/with-redux-store';\nimport { setUser } from '../store';\nimport { countries, javaScriptKey, applicationId, serverURL } from '../constants';\nimport Layout from '../components/Layout';\n\nvar MyApp =\n/*#__PURE__*/\nfunction (_App) {\n  _inherits(MyApp, _App);\n\n  function MyApp() {\n    _classCallCheck(this, MyApp);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(MyApp).apply(this, arguments));\n  }\n\n  _createClass(MyApp, [{\n    key: \"render\",\n    value: function render() {\n      if (process.browser) {\n        Parse.initialize(applicationId, javaScriptKey);\n        Parse.serverURL = serverURL;\n      }\n\n      var _this$props = this.props,\n          Component = _this$props.Component,\n          pageProps = _this$props.pageProps,\n          reduxStore = _this$props.reduxStore,\n          lang = _this$props.lang;\n      Parse.User.currentAsync().then(\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee(user) {\n          var userJson;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  userJson = user && user.toJSON();\n                  reduxStore.dispatch(setUser(userJson));\n\n                  if (!userJson) {\n                    _context.next = 25;\n                    break;\n                  }\n\n                  cookie.set('user', userJson);\n                  _context.prev = 4;\n\n                  if (!(userJson.lang === lang)) {\n                    _context.next = 11;\n                    break;\n                  }\n\n                  _context.next = 8;\n                  return Parse.User.current().fetch();\n\n                case 8:\n                  userJson = _context.sent.toJSON();\n                  _context.next = 15;\n                  break;\n\n                case 11:\n                  user.set('lang', lang);\n                  _context.next = 14;\n                  return user.save();\n\n                case 14:\n                  userJson = _context.sent.toJSON();\n\n                case 15:\n                  _context.next = 21;\n                  break;\n\n                case 17:\n                  _context.prev = 17;\n                  _context.t0 = _context[\"catch\"](4);\n                  Parse.User.logOut();\n                  userJson = undefined;\n\n                case 21:\n                  reduxStore.dispatch(setUser(userJson));\n\n                  if (userJson) {\n                    cookie.set('user', userJson);\n                  } else {\n                    cookie.remove('user');\n                  }\n\n                  _context.next = 26;\n                  break;\n\n                case 25:\n                  cookie.remove('user');\n\n                case 26:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[4, 17]]);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n      return __jsx(Provider, {\n        store: reduxStore\n      }, __jsx(Layout, null, __jsx(Component, pageProps)));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(_ref2) {\n        var Component, ctx, reduxStore, res, pathname, query, req, _nextCookie, user, myCountry, pageProps, lang;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                Component = _ref2.Component, ctx = _ref2.ctx;\n                reduxStore = ctx.reduxStore, res = ctx.res, pathname = ctx.pathname, query = ctx.query, req = ctx.req;\n                _nextCookie = nextCookie(ctx), user = _nextCookie.user;\n                user = user && JSON.parse(user);\n\n                if (user) {\n                  reduxStore.dispatch(setUser(user));\n                  myCountry = \"/\".concat(user.country);\n\n                  if ((!query || query.ref !== user.ref) && myCountry === pathname || myCountry !== pathname && countries.includes(pathname.replace('/', ''))) {\n                    query.ref = user.ref;\n\n                    if (res) {\n                      res.writeHead(302, {\n                        Location: \"\".concat(myCountry, \"?\").concat(qs.stringify(query))\n                      });\n                      res.end();\n                    } else {\n                      Router.push(\"\".concat(myCountry, \"?\").concat(qs.stringify(query)));\n                    }\n                  }\n                }\n\n                if (!Component.getInitialProps) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                _context2.next = 8;\n                return Component.getInitialProps(ctx);\n\n              case 8:\n                _context2.t0 = _context2.sent;\n                _context2.next = 12;\n                break;\n\n              case 11:\n                _context2.t0 = {};\n\n              case 12:\n                pageProps = _context2.t0;\n                lang = req ? req.language : i18n.language;\n                return _context2.abrupt(\"return\", {\n                  pageProps: pageProps,\n                  lang: lang\n                });\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function getInitialProps(_x2) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return MyApp;\n}(App);\n\nexport default withReduxStore(appWithTranslation(MyApp));","map":{"version":3,"sources":["C:\\Users\\Mahmoud\\merquant_prelunch\\pages\\_app.jsx"],"names":["React","App","Parse","Provider","nextCookie","cookie","Router","qs","appWithTranslation","i18n","withReduxStore","setUser","countries","javaScriptKey","applicationId","serverURL","Layout","MyApp","process","browser","initialize","props","Component","pageProps","reduxStore","lang","User","currentAsync","then","user","userJson","toJSON","dispatch","set","current","fetch","save","logOut","undefined","remove","ctx","res","pathname","query","req","JSON","parse","myCountry","country","ref","includes","replace","writeHead","Location","stringify","end","push","getInitialProps","language"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport App from 'next/app';\r\nimport Parse from 'parse';\r\nimport { Provider } from 'react-redux';\r\nimport nextCookie from 'next-cookies';\r\nimport cookie from 'js-cookie';\r\nimport Router from 'next/router';\r\nimport * as qs from 'qs';\r\nimport { appWithTranslation, i18n } from '../i18n';\r\nimport withReduxStore from '../lib/with-redux-store';\r\nimport { setUser } from '../store';\r\nimport {\r\n  countries, javaScriptKey, applicationId, serverURL,\r\n} from '../constants';\r\nimport Layout from '../components/Layout'\r\n\r\nclass MyApp extends App {\r\n  static async getInitialProps({ Component, ctx }) {\r\n    const {\r\n      reduxStore, res, pathname, query, req,\r\n    } = ctx;\r\n    let { user } = (nextCookie(ctx));\r\n    user = user && JSON.parse(user);\r\n    if (user) {\r\n      reduxStore.dispatch(setUser(user));\r\n      const myCountry = `/${user.country}`;\r\n      if (((!query || query.ref !== user.ref) && myCountry === pathname)\r\n        || (myCountry !== pathname && countries.includes(pathname.replace('/', '')))) {\r\n        query.ref = user.ref;\r\n\r\n        if (res) {\r\n          res.writeHead(302, {\r\n            Location: `${myCountry}?${qs.stringify(query)}`,\r\n          });\r\n          res.end();\r\n        } else {\r\n          Router.push(`${myCountry}?${qs.stringify(query)}`);\r\n        }\r\n      }\r\n    }\r\n\r\n    const pageProps = Component.getInitialProps ? await Component.getInitialProps(ctx) : {};\r\n    const lang = (req ? req.language : i18n.language);\r\n\r\n    return {\r\n      pageProps,\r\n      lang,\r\n    };\r\n  }\r\n\r\n  render() {\r\n    if (process.browser) {\r\n      Parse.initialize(applicationId, javaScriptKey);\r\n      Parse.serverURL = serverURL;\r\n    }\r\n    const {\r\n      Component, pageProps, reduxStore, lang,\r\n    } = this.props;\r\n\r\n    Parse.User.currentAsync()\r\n      .then(async (user) => {\r\n        let userJson = user && user.toJSON();\r\n        reduxStore.dispatch(setUser(userJson));\r\n\r\n        if (userJson) {\r\n          cookie.set('user', userJson);\r\n          try {\r\n            if (userJson.lang === lang) {\r\n              userJson = (await Parse.User.current()\r\n                .fetch()).toJSON();\r\n            } else {\r\n              user.set('lang', lang);\r\n              userJson = (await user.save())\r\n                .toJSON();\r\n            }\r\n          } catch (e) {\r\n            Parse.User.logOut();\r\n            userJson = undefined;\r\n          }\r\n          reduxStore.dispatch(setUser(userJson));\r\n          if (userJson) {\r\n            cookie.set('user', userJson);\r\n          } else {\r\n            cookie.remove('user');\r\n          }\r\n        } else {\r\n          cookie.remove('user');\r\n        }\r\n      });\r\n    return (\r\n      <Provider store={reduxStore}>\r\n        <Layout>\r\n          {/* eslint-disable-next-line react/jsx-props-no-spreading */}\r\n          <Component {...pageProps} />\r\n        </Layout>\r\n      </Provider>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withReduxStore(appWithTranslation(MyApp));\r\n"]},"metadata":{},"sourceType":"module"}